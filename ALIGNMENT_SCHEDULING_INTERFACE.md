# Alignment и SchedulingIncrement Интерфейс

## Обзор

Добавени са полета за редактиране на `alignment` и `schedulingIncrement` в съществуващия Acuity Manager интерфейс, като се запазва цялостният дизайн и функционалност.

## Промени в Services (Услуги)

### Форма за редактиране на услуга

Добавени са две нови полета в секция "Услуги" → "Редактиране на услуга":

1. **Интервал на резервации (schedulingIncrement)**
   - Тип: Падащо меню (dropdown)
   - Опции: 5, 10, 15, 30, 45, 60, 90, 120 минути
   - Описание: "На колко минути клиентите могат да резервират"
   - Стойност по подразбиране: 15 минути

2. **Подравняване (alignment)**
   - Тип: Падащо меню (dropdown)
   - Опции: 0, 15, 30, 45 минути
   - Описание: "На коя минута от часа започват резервациите"
   - Стойност по подразбиране: 0 (точно на часа)

### Таблица със списък на услугите

Добавени са две нови колони:
- **Интервал**: Показва текущата стойност на schedulingIncrement (в минути)
- **Alignment**: Показва текущата стойност на alignment

### Функционалност

- При натискане на "Редактирай" за услуга, формата се попълва с текущите стойности включително alignment и schedulingIncrement
- При запазване, новите стойности се изпращат към Acuity API чрез PATCH заявка към `/acuity/appointment-types/{id}`
- След успешно запазване, таблицата се презарежда и показва актуализираните стойности

## Промени в Calendars (Календари)

### Диалог за редактиране на календар

Добавени са два нови prompt диалога в секция "Календари" → "Редактирай":

1. **Интервал на резервации (schedulingIncrement)**
   - Prompt със съществуваща стойност
   - Инструкции за валидни стойности: 5, 10, 15, 30, 45, 60, 90, 120
   - Описание как работи параметърът

2. **Подравняване (alignment)**
   - Prompt със съществуваща стойност
   - Инструкции за валидни стойности: 0, 15, 30, 45
   - Описание как работи параметърът с примери

### Дисплей на календари

Добавени са две нови полета в информацията за всеки календар:
- **Интервал на резервации**: Показва schedulingIncrement (в минути)
- **Подравняване**: Показва alignment (в минути)

### Функционалност

- При натискане на "Редактирай" за календар, появяват се последователни prompt-и за всички параметри
- Новите стойности за alignment и schedulingIncrement се валидират и включват в PATCH заявката към `/acuity/calendars/{id}`
- След успешно запазване, информацията за календара се презарежда с актуализираните стойности

## Технически детайли

### API Endpoints

Използвани съществуващи endpoints в worker-backend.js:

```javascript
// За услуги
PATCH /acuity/appointment-types/{id}
Body: {
  name: string,
  description: string,
  duration: number,
  price: number,
  schedulingIncrement: number,  // ⭐ НОВО
  alignment: number,             // ⭐ НОВО
  color: string,
  active: boolean,
  private: boolean
}

// За календари
PATCH /acuity/calendars/{id}
Body: {
  name: string,
  email: string,
  description: string,
  timezone: string,
  schedulingIncrement: number,  // ⭐ НОВО
  alignment: number              // ⭐ НОВО
}
```

### JavaScript промени

**acuity-manager.js:**

1. `editService()` - Добавено попълване на полетата schedulingIncrement и alignment
2. `updateService()` - Добавено изпращане на schedulingIncrement и alignment към API
3. `displayServices()` - Добавени колони за Интервал и Alignment в таблицата
4. `editCalendar()` - Добавени prompt-и за schedulingIncrement и alignment
5. `displayCalendarsManagement()` - Добавена информация за schedulingIncrement и alignment

### HTML промени

**acuity-manager.html:**

Добавени два нови `<div class="form-group">` блока в секцията за редактиране на услуги:
- Select с id `service-scheduling-increment`
- Select с id `service-alignment`

## Как да използвате

### За услуги:

1. Отидете на секция "Услуги"
2. Натиснете "Презареди услуги" за да заредите списъка
3. Таблицата ще покаже текущите стойности на Интервал и Alignment
4. Натиснете "Редактирай" за избраната услуга
5. Променете schedulingIncrement и/или alignment от падащите менюта
6. Натиснете "Запази промени"

### За календари:

1. Отидете на секция "Календари"
2. Натиснете "Презареди календари"
3. Прегледайте текущите стойности на Интервал и Alignment за всеки календар
4. Натиснете "Редактирай" за избрания календар
5. Следвайте prompt-ите и въведете нови стойности за schedulingIncrement и alignment
6. Промените се запазват автоматично

## Валидация и грешки

### Acuity план ограничения

Ако Acuity планът не поддържа API редакция, ще се покаже подробно съобщение с инструкции как да редактирате параметрите директно в Acuity Scheduling интерфейса.

### Валидни стойности

- **schedulingIncrement**: 5, 10, 15, 30, 45, 60, 90, 120 (минути)
- **alignment**: 0, 15, 30, 45 (минути)

## Примери за комбинации

### Резервации на всеки 30 минути, започващи точно на часа:
- schedulingIncrement: 30
- alignment: 0
- Резултат: 10:00, 10:30, 11:00, 11:30...

### Резервации на всеки 15 минути, започващи от 15-та минута:
- schedulingIncrement: 15
- alignment: 15
- Резултат: 10:15, 10:30, 10:45, 11:00, 11:15...

### Резервации на всеки час, на половин час:
- schedulingIncrement: 60
- alignment: 30
- Резултат: 10:30, 11:30, 12:30, 13:30...

## Съвместимост

Промените са напълно съвместими със съществуващия код:
- Запазен е целият съществуващ интерфейс
- Добавени са само нови полета и функционалност
- Не са премахнати или променени съществуващи функции
- AI асистентът вече поддържа alignment и schedulingIncrement команди

## Препратки

- [ALIGNMENT_SCHEDULING_GUIDE.md](ALIGNMENT_SCHEDULING_GUIDE.md) - Подробно ръководство за alignment и schedulingIncrement
- [README.md](README.md) - Основна документация на проекта
- [worker-backend.js](worker-backend.js) - Worker endpoints за API заявки
