# Acuity Мениджър с AI Асистент - Документация

## Въведение

Acuity Мениджър е мощен инструмент за управление на Acuity Scheduling резервации, интегриран с AI асистент. Системата позволява пълен контрол над резервациите, клиентите и предоставя интелигентен помощник за автоматизация на задачите.

**ВАЖНО:** Това е защитен инструмент за управление на компрометирани Acuity акаунти, на които нямате директен достъп.

## Защо е създаден

Този инструмент е проектиран като "анти-хакер пакет" - сигурен начин за достъп до Acuity Scheduling API без нужда от директен вход в платформата. Всички API заявки минават през защитен Cloudflare Worker backend, където API credentials са съхранени безопасно като secrets.

## Основни функции

### 1. Табло с Статистика

Централното табло предоставя бърз преглед на:
- Общ брой резервации
- Брой регистрирани клиенти
- Налични видове тренировки
- Предстоящи резервации

### 2. Управление на Резервации

Секцията "Резервации" позволява:
- **НОВ:** Избор на календар за преглед на резервации
- **НОВ:** Филтриране по тип тренировка
- Преглед на всички резервации за избран календар
- Сортиране по дата
- Виждане на статус (потвърдени, чакащи, отменени)
- Детайлна информация за всяка резервация
- **НОВ:** Търсене на резервация по ID
- **НОВ:** Отмяна на резервация
- **НОВ:** Пренасрочване на резервация
- **НОВ:** Масова отмяна на резервации (спешни случаи)

#### Как да използвате филтрирането:

1. Отидете в таб "Резервации"
2. Изберете календар от падащото меню
3. (Опционално) Изберете конкретен тип тренировка
4. Натиснете "Зареди резервации"
5. Резервациите за избрания календар ще се покажат в таблицата

**Забележка:** По подразбиране не се зареждат резервации до избиране на календар.

### 3. База Данни с Клиенти

Достъп до пълна информация за всички клиенти:
- Име и фамилия
- Телефонен номер
- Имейл адрес
- История на резервации
- **НОВ:** Експорт на клиенти в CSV/JSON
- **НОВ:** Търсене на клиенти по име, email или телефон
- **НОВ:** Блокиране на клиенти (черен списък)
- **НОВ:** Изтриване на клиенти
- **НОВ:** Преглед на детайли за клиент

#### Управление на клиенти:

**Търсене на клиент:**
1. Използвайте полето за търсене в горната част
2. Въвеждайте име, email или телефон
3. Списъкът се филтрира автоматично

**Блокиране на клиент:**
1. Намерете клиента в списъка или търсете по ID
2. Натиснете "Виж детайли" или търсете по ID
3. Натиснете "Блокирай клиент"
4. Потвърдете действието

Блокираните клиенти:
- Се отбелязват в червено в списъка
- Се съхраняват локално в браузъра
- Не могат да правят нови резервации (трябва ръчно да откажете заявките)
- Могат да бъдат отблокирани по всяко време

**Изтриване на клиент:**
1. Намерете клиента и вижте неговите детайли
2. Натиснете "Изтрий клиент"
3. Прочетете предупреждението
4. Напишете "ИЗТРИЙ" за финално потвърждение

⚠️ **ВНИМАНИЕ:** Изтриването е необратимо! Резервациите остават, но клиентът се премахва от системата.

### 4. Управление на Календари (НОВ)

Пълен контрол над календарите:
- Преглед на всички активни календари
- Информация за всеки календар
- Блокиране на специфични часове/дати
- Управление на блокирани периоди
- Създаване на нови блокове за недостъпност

#### Как да блокирате часове:

1. Отидете в таб "Календари"
2. Изберете "Добави блокиран период"
3. Изберете календар
4. Задайте начална и крайна дата/час
5. Добавете причина (опционално)
6. Натиснете "Създай блокиран период"

#### Промяна на работно време (НОВ):

**Метод 1: Директен достъп до Acuity**
1. Влезте в Acuity Scheduling
2. Отидете на Calendar → Business Hours
3. Променете работните часове
4. Запазете

**Метод 2: Използване на бързия помощник (без достъп до Acuity)**
1. Отидете в таб "Календари"
2. Намерете секцията "Работно време на календарите"
3. Натиснете "Бърз помощник за график"
4. Изберете календар и период
5. Изберете какво искате да блокирате:
   - Сутрините (00:00-09:00)
   - Вечерите (18:00-23:59)
   - Целия ден (00:00-23:59)
   - Персонализиран период
6. Поставете отметка на "Повтаряй за всеки ден" ако искате
7. Натиснете "Приложи график"

Примери:
- **Затворете в неделя:** Изберете неделя, "Целия ден", с повторение
- **Затворете сутрините:** Изберете период, "Сутрините", с повторение
- **Ваканция:** Изберете период, "Целия ден", без повторение

### 5. Експорт на данни (НОВ)

Изтегляне на резервни копия:

#### Експорт на клиенти:
- CSV формат (отваря се с Excel)
- JSON формат (за програмна обработка)
- Съдържа: ID, име, фамилия, email, телефон

#### Експорт на резервации:
- CSV формат
- JSON формат
- Филтриране по календар
- Съдържа: ID, дата, час, клиент, телефон, email, тип, статус

#### Експорт на типове тренировки:
- CSV формат
- JSON формат
- Съдържа: ID, име, описание, продължителност, цена

### 6. Управление на профил (НОВ)

Критични настройки за компрометирани акаунти:

#### Информация за бизнеса:
- Преглед на бизнес информация
- Име, email, телефон, адрес
- Часова зона

#### Информация за плащане:
- Инструкции за достъп до billing portal
- Стъпки за промяна на платежна информация
- Алтернативи при хакнат акаунт
- Контакти за Acuity Support

#### API Ключове:
- Инструкции за регенериране
- Команди за обновяване на Worker secrets
- Защитни мерки

#### Защитни мерки - Checklist:
- [ ] Смяна на парола
- [ ] Активиране на 2FA
- [ ] Регенериране на API ключове
- [ ] Преглед на резервации
- [ ] Смяна на email (ако е възможно)
- [ ] Проверка на интеграции
- [ ] Експорт на данни за бекъп

#### Спешен режим "LOCKDOWN" (НОВ):

**ВНИМАНИЕ: Използвайте САМО при активно хакване!**

Какво прави Lockdown:
- ✓ Създава блокове за ВСИЧКИ календари за следващите 30 дни
- ✓ Запазва съществуващите резервации
- ✓ Предотвратява нови резервации от клиенти
- ✓ Може да бъде обратим

Как да активирате:
1. Отидете в таб "Профил"
2. Намерете секцията "СПЕШЕН РЕЖИМ LOCKDOWN"
3. Прочетете внимателно какво прави
4. Поставете отметка на "Разбирам последствията"
5. Натиснете "АКТИВИРАЙ LOCKDOWN"

Как да деактивирате:
1. Натиснете "Деактивирай Lockdown"
2. Потвърдете действието
3. Всички създадени блокове ще бъдат премахнати

### 7. Създаване на Нови Резервации

Удобна форма за бързо създаване на резервации:
- Избор на вид тренировка
- Избор на календар/треньор
- Дата и час
- Информация за клиента (име, телефон, имейл)

### 8. AI Асистент

Интелигентен асистент, който може да:

#### Отговаря на въпроси
- "Колко резервации имаме днес?"
- "Кои са предстоящите резервации?"
- "Покажи ми информация за клиент Иван Петров"

#### Създава резервации
- "Създай резервация за Мария Иванова на 20 януари в 14:00"
- "Запиши тренировка за Георги Димитров утре в 10 часа"

#### Търси информация
- "Кои клиенти имат резервации тази седмица?"
- "Колко свободни места има във вторник?"

## Настройка

### Стъпка 1: Конфигуриране на Acuity API

За да работи системата, трябва да имате Acuity Scheduling акаунт и API credentials:

1. Влезте в Acuity Scheduling
2. Отидете в Settings > Integrations > API
3. Генерирайте User ID и API Key

### Стъпка 2: Конфигуриране на Cloudflare Worker

Добавете Acuity credentials като Worker secrets:

```bash
# Добавяне на Acuity User ID
wrangler secret put ACUITY_USER

# Добавяне на Acuity API Key
wrangler secret put ACUITY_KEY
```

### Стъпка 3: Deploy на Worker

```bash
# Deploy на worker-backend.js
wrangler deploy
```

### Стъпка 4: Конфигуриране на AI Асистент

За да използвате AI асистента, трябва да имате API ключ от един от поддържаните providers:

#### OpenAI
1. Регистрирайте се на https://platform.openai.com/
2. Генерирайте API key от API Keys секцията
3. Въведете ключа в полето "API ключ" в Acuity Manager

#### Google AI (Gemini)
1. Отидете на https://makersuite.google.com/app/apikey
2. Създайте нов API key
3. Въведете ключа в полето "API ключ" в Acuity Manager

## Използване

### Основна навигация

Интерфейсът е разделен на две панела:

**Ляв панел:** Основни функции (табло, резервации, клиенти, нова резервация)
**Десен панел:** AI Асистент

### Работа с AI Асистент

1. **Изберете AI Provider:** OpenAI или Google AI
2. **Въведете API ключ:** Вашият personal API key
3. **Пишете на естествен език:** AI асистентът разбира български език

### Примери за команди

#### Информационни заявки
```
"Колко резервации имаме общо?"
"Покажи ми клиентите"
"Кои са предстоящите тренировки?"
"Има ли резервации за утре?"
```

#### Създаване на резервации
```
"Създай резервация за:
- Име: Иван Петров
- Телефон: +359888123456
- Имейл: ivan@example.com
- Дата: 15 януари 2024
- Час: 10:00"
```

Забележка: Когато AI асистентът предложи да създаде резервация, той ще попълни формата автоматично. Проверете данните и натиснете "Създай резервация".

## API Endpoints

Worker backend предоставя следните endpoints:

### GET /acuity
Връща списък с резервации.

**Query параметри:**
- `calendarID` (задължителен): ID на календара
- `appointmentTypeID` (опционален): ID на типа резервация

**Пример:**
```
GET /acuity?calendarID=12342518&appointmentTypeID=80052001
```

### POST /acuity
Създава нова резервация.

**Body (JSON):**
```json
{
  "appointmentTypeID": "80052001",
  "calendarID": "12342518",
  "datetime": "2024-01-15T10:00:00",
  "firstName": "Иван",
  "lastName": "Петров",
  "phone": "+359888123456",
  "email": "ivan@example.com"
}
```

### PUT /acuity/appointments/:id (НОВ)
Актуализира резервация.

**URL параметри:**
- `id`: ID на резервацията

**Body (JSON):**
```json
{
  "datetime": "2024-01-16T14:00:00"
}
```

### PUT /acuity/appointments/:id/cancel (НОВ)
Отменя резервация.

**URL параметри:**
- `id`: ID на резервацията

**Body (JSON) - опционален:**
```json
{
  "cancelNote": "Причина за отмяна"
}
```

### GET /acuity/clients
Връща списък с всички клиенти.

### PUT /acuity/clients/:id (НОВ)
Актуализира информация за клиент.

**URL параметри:**
- `id`: ID на клиента

**Body (JSON):**
```json
{
  "firstName": "Ново име",
  "lastName": "Нова фамилия",
  "phone": "+359888999888",
  "email": "new@email.com"
}
```

### GET /acuity/appointment-types
Връща налични видове резервации/тренировки.

### GET /acuity/calendars
Връща налични календари.

### PUT /acuity/calendars/:id (НОВ)
Актуализира календар.

**URL параметри:**
- `id`: ID на календара

**Body (JSON):**
```json
{
  "name": "Ново име",
  "description": "Ново описание"
}
```

### GET /acuity/availability
Проверява наличност за резервации.

**Query параметри:**
- `appointmentTypeID` (задължителен)
- `month` (задължителен): формат YYYY-MM
- `calendarID` (опционален)

### GET /acuity/blocks (НОВ)
Връща всички блокирани периоди.

**Query параметри:**
- `calendarID` (опционален): Филтрира по календар

### POST /acuity/blocks (НОВ)
Създава нов блокиран период.

**Body (JSON):**
```json
{
  "calendarID": "12342518",
  "start": "2024-01-15T09:00:00",
  "end": "2024-01-15T17:00:00",
  "notes": "Личен отпуск"
}
```

### DELETE /acuity/blocks/:id (НОВ)
Изтрива блокиран период.

**URL параметри:**
- `id`: ID на блока

### DELETE /acuity/clients/:id (НОВ)
Изтрива клиент.

**URL параметри:**
- `id`: ID на клиента

**Response:**
```
204 No Content (успешно изтриване)
```

### GET /acuity/business-info (НОВ)
Връща информация за бизнеса.

**Response:**
```json
{
  "name": "Fitness Studio",
  "email": "info@studio.com",
  "phone": "+359888123456",
  "website": "https://studio.com",
  "address": "ул. Примерна 123, София",
  "timezone": "Europe/Sofia"
}
```

## Сигурност

### Защита на API Credentials

- API credentials се съхраняват като Worker secrets
- Никога не се изпращат на frontend
- Всички заявки минават през защитен backend
- CORS headers позволяват само разрешени заявки

### Защита на AI API Keys

- AI API keys се въвеждат от потребителя
- Съхраняват се само в браузъра (не се записват на сървър)
- Използват се директно от frontend към AI provider
- Препоръчваме използване на API keys с ограничени права

## Troubleshooting

### Проблем: Не могат да се заредят резервациите

**Решение:**
1. Проверете дали Worker е deploy-нат правилно
2. Проверете дали ACUITY_USER и ACUITY_KEY са настроени
3. Проверете browser console за грешки
4. Уверете се, че calendarID и appointmentTypeID са правилни

### Проблем: AI асистентът не работи

**Решение:**
1. Проверете дали сте въвели валиден API ключ
2. Проверете дали имате достатъчно credits в AI provider акаунта
3. Проверете browser console за грешки
4. Опитайте с различен AI provider

### Проблем: Не може да се създаде резервация

**Решение:**
1. Проверете дали всички задължителни полета са попълнени
2. Уверете се, че датата и часът са във валиден формат
3. Проверете дали избраният календар и тип резервация са активни
4. Погледнете отговора на API в browser console

### Проблем: Не може да се отмени резервация (НОВ)

**Решение:**
1. Уверете се, че резервацията все още съществува
2. Проверете дали имате правилно ID на резервацията
3. Погледнете дали резервацията вече не е отменена
4. Проверете console за грешки от API

### Проблем: Lockdown режим не се активира (НОВ)

**Решение:**
1. Уверете се, че сте зарезили календарите
2. Проверете че Worker има достъп до Acuity API
3. Погледнете browser console за грешки
4. Опитайте да създадете ръчно блок за един календар първо

### Проблем: Експортът на данни не работи (НОВ)

**Решение:**
1. Първо заредете данните (натиснете "Презареди")
2. Проверете дали браузърът ви разрешава изтегляне на файлове
3. Ако файлът не се отваря правилно в Excel, използвайте "Отвори с кодировка UTF-8"
4. JSON файловете могат да се отворят с текстов редактор

### Проблем: Не мога да изтрия клиент (НОВ)

**Решение:**
1. Уверете се, че имате правилно ID на клиента
2. Проверете дали клиентът съществува в Acuity
3. Проверете console за грешки
4. Имайте предвид, че някои API планове не разрешават изтриване на клиенти

### Проблем: Блокираните клиенти не се запазват (НОВ)

**Решение:**
1. Блокираните клиенти се съхраняват в localStorage на браузъра
2. Ако изчистите браузъра, те ще бъдат изгубени
3. Препоръчваме да експортирате списъка на блокирани клиенти периодично
4. Ако сменяте браузър/устройство, трябва да блокирате клиентите отново

### Проблем: Бързият помощник за график не работи (НОВ)

**Решение:**
1. Уверете се, че сте заредили календарите
2. Проверете дали периодът е валиден (начална дата < крайна дата)
3. Ако създавате много блокове, изчакайте - има забавяне между заявките
4. Проверете browser console за грешки

### Проблем: Не мога да отменя часове (НОВ)

**Решение:**
1. Уверете се, че имате права за създаване на блокове
2. Проверете дали календарът приема блокове
3. Проверете дали датите не са в миналото
4. Погледнете дали блоковете не се припокриват с резервации

## Използване при хакнат акаунт

### Сценарий: Акаунтът ви е хакнат и нямате достъп

**Незабавни действия:**

1. **Активирайте Lockdown режим**
   - Отидете в таб "Профил"
   - Активирайте "СПЕШЕН РЕЖИМ LOCKDOWN"
   - Това ще предотврати нови резервации за 30 дни

2. **Експортирайте всички данни**
   - Отидете в таб "Експорт"
   - Изтеглете клиенти (CSV + JSON)
   - Изтеглете резервации (CSV + JSON)
   - Изтеглете типове тренировки (CSV + JSON)
   - Запазете файловете на безопасно място

3. **Свържете се с Acuity Support**
   - Email: support@acuityscheduling.com
   - Телефон: +1 (888) 729-8645
   - Обяснете ситуацията
   - Предоставете доказателства за собственост

4. **Преглед на резервациите**
   - Проверете за подозрителни резервации
   - Отменете фалшиви резервации чрез "Резервации" таб
   - Използвайте масова отмяна ако е необходимо

5. **Променете API credentials**
   - След като възстановите достъп
   - Регенерирайте API ключовете
   - Обновете Worker secrets

### Сценарий: Нуждаете се от временна блокада

**Стъпки:**

1. Отидете в "Календари" таб
2. Изберете календара, който искате да блокирате
3. Използвайте "Добави блокиран период"
4. Задайте желания период
5. Повторете за всеки календар

**Алтернатива:** Използвайте Lockdown режим за бързо блокиране на всички календари.

### Сценарий: Нужда от масова промяна

**Примери:**

**Отмяна на всички резервации за определен ден:**
1. Отидете в "Резервации" таб
2. Изберете календар и период
3. Натиснете "Покажи резервации за отмяна"
4. Прегледайте списъка
5. Натиснете "ОТМЕНИ ВСИЧКИ" и напишете "ОТМЕНИ" за потвърждение

**Блокиране на цяла седмица:**
1. Отидете в "Календари" таб
2. За всеки календар създайте блок
3. Задайте начало и край на седмицата
4. Добавете причина (напр. "Празници")

**Алтернатива:** Използвайте бързия помощник за график

### Сценарий: Трябва да блокирате проблемен клиент

**Стъпки:**

1. Отидете в "Клиенти" таб
2. Намерете клиента чрез търсенето или по ID
3. Натиснете "Виж детайли"
4. Натиснете "Блокирай клиент"
5. Потвърдете

**Какво прави блокирането:**
- Клиентът се маркира като блокиран в системата
- Запазва се локално във вашия браузър
- Можете да видите всички блокирани клиенти
- Ако клиентът се опита да направи резервация, ще го видите маркиран като блокиран

**Важно:** Блокирането НЕ предотвратява автоматично резервации в Acuity. Трябва ръчно да откажете заявките на блокирани клиенти.

### Сценарий: Трябва да изтриете фалшиви клиенти

**Стъпки:**

1. Експортирайте клиентите първо (за бекъп)
2. Отидете в "Клиенти" таб
3. Намерете подозрителния клиент
4. Вижте неговите детайли
5. Натиснете "Изтрий клиент"
6. Прочетете предупреждението
7. Напишете "ИЗТРИЙ" за потвърждение

⚠️ **ВНИМАНИЕ:** Това е необратимо! Използвайте само за очевидно фалшиви/тестови клиенти.

### Сценарий: Трябва да промените работното време

**Метод 1: Чрез бързия помощник**

1. Отидете в "Календари" таб
2. Намерете "Бърз помощник за график"
3. Изберете календар
4. Задайте период (напр. 1 месец)
5. Изберете какво да блокирате:
   - Сутрините (ако не работите преди 9:00)
   - Вечерите (ако не работите след 18:00)
   - Конкретни дни (събота/неделя)
6. Поставете отметка на "Повтаряй за всеки ден"
7. Приложете

**Метод 2: Ръчно блокиране**

За по-сложни графици:
1. Отидете в "Календари" таб
2. Добавете блокове за всеки нежелан период
3. Повторете за всеки ден/календар

**Примери за типични графици:**

| Нужда | Настройка |
|-------|----------|
| Работя 9:00-17:00 | Блокирай 00:00-09:00 и 17:00-23:59 |
| Почивка събота/неделя | Блокирай целия ден за уикенда |
| Обедна почивка 12-13 | Блокирай 12:00-13:00 всеки ден |
| Затворено през август | Блокирай целия месец |

## Ограничения

- Максимум 100 резервации могат да се заредят наведнъж (ограничение на Acuity API)
- AI асистентът изисква активна интернет връзка
- Acuity API има rate limits (обикновено 100 заявки/минута)
- Lockdown режим блокира само нови резервации, не и съществуващите
- Масовите операции имат малка забавяна между заявки за да се избегне rate limiting
- **НОВ:** Блокираните клиенти се съхраняват локално в браузъра (не синхронизирани между устройства)
- **НОВ:** Изтриването на клиенти е необратимо
- **НОВ:** Бързият помощник за график може да създаде много блокове - използвайте внимателно
- **НОВ:** Промяната на работно време чрез блокове е симулация - за истинска промяна използвайте Acuity директно

## Известни проблеми

- Блокирането на клиенти е само визуално - Acuity API няма вградена функция за блокиране
- Клиентите, блокирани локално, трябва ръчно да се блокират отново на ново устройство
- При много големи експорти (>1000 записа) може да забави браузъра
- Бързият помощник може да отнеме няколко минути при създаване на много блокове

## Бъдещи подобрения

Планирани функции за следващи версии:
- ✅ Редактиране и отмяна на резервации (ИМПЛЕМЕНТИРАНО)
- ✅ Експорт на данни в различни формати (ИМПЛЕМЕНТИРАНО)
- ✅ Блокиране на календари (ИМПЛЕМЕНТИРАНО)
- ✅ Спешен lockdown режим (ИМПЛЕМЕНТИРАНО)
- ✅ Изтриване на клиенти (ИМПЛЕМЕНТИРАНО)
- ✅ Блокиране на клиенти (ИМПЛЕМЕНТИРАНО)
- ✅ Управление на работно време (ИМПЛЕМЕНТИРАНО чрез блокове)
- Статистика и аналитика
- Email известия
- SMS напомняния
- Интеграция с други календари
- Автоматично откриване на подозрителна активност
- Audit log за всички действия
- Синхронизация на блокирани клиенти в cloud
- Автоматично блокиране на спам резервации
- Експорт на работни графици
- Импорт на блокове от файл

## Съвети за сигурност

### Ежедневни действия:
1. Редовно проверявайте резервациите за аномалии
2. Експортирайте данни веднъж седмично
3. Наблюдавайте за неочаквани резервации
4. Проверявайте email известията от Acuity

### Месечни действия:
1. Обновете API ключовете
2. Прегледайте списъка с клиенти
3. Проверете блокираните периоди
4. Актуализирайте информацията за бизнеса

### При съмнение:
1. Активирайте Lockdown веднага
2. Експортирайте всички данни
3. Свържете се с Acuity Support
4. Променете всички пароли и ключове
5. Активирайте 2FA

## Поддръжка

За въпроси и проблеми, моля отворете issue в GitHub repository.

## Лиценз

Проектът е част от Into Design Studio портфолио.
